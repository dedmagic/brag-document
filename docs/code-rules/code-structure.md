# Структура кода

1. Размер класса не может превышать 700 строк, включая скобки, пустые строки и т.д. Если приведение класса к данному стандарту затруднительно ввиду дефицита времени, допускается просто уменьшить его размер на любое количество строк.
2. Длина метода не может превышать 40 строк, включая скобки, пустые строки и т.д. Если приведение очень большого метода к данному стандарту затруднительно ввиду дефицита времени, допускается этот метод просто разбить на любое количество частей любого размера.
3. Длина строки кода не может превышать 100 символов. Исключение: если строковый литерал сам по себе превышает допустимую длину строки кода, допустимо игнорировать это ограничение.
4. Если длина строки не превышает установленный лимит, то разбивать её на части возможно только в двух случаях: при использовании текучего (fluent) интерфейса и при вызове из заголовка конструктора класса конструктора базового класса (т.е. base(..)).
5. Каждый тип должен располагаться в отдельном файле. Исключение – вложенные типы.
6. Не допускаются вложенные типы, доступные извне родительского типа.
7. Максимально допустимый уровень вложенности кода - три

```csharp
// Неправильно
if (a)
{
    if (b)
    {
        if (c)
        {
            if (d)
            {
                DoSomething();
            }
        }
    }
}

// Правильно
if (a)
{
    if (b)
    {
        if (c)
        {
           DoSomething();
        }
    }
}
```

8. Тело цикла или ветвь условного оператора всегда должны быть заключены в операторные скобки, даже если состоят из единственной строки. Операторные скобки должны располагаться на отдельных строках

```csharp
// Неправильно:
if (cds == null || cds.Id == Guid.Empty)
    continue;

// Неправильно:
if (cds == null || cds.Id == Guid.Empty) {
    continue;
}

// Правильно:
if (cds == null || cds.Id == Guid.Empty)
{
    continue;
}
```

9. Переменные и константы должны объявляться максимально близко к месту своего первого использования.
10. Модуль должен иметь следующую структуру (т.е. порядок следования разделов):

**Структура модуля:**
```
Константы
Статические поля/свойства
Публичные поля/свойства
Приватные поля/свойства
Конструкторы
Статические методы
Публичные методы
Приватные методы
```

При этом разделы следует заключать в регионы, которые должны носить англоязычные наименования.

11. В случае разбиения длинной строки кода по разделителям (запятым, логическим операциям и т.д.), разделители должны переносится в начало следующей строки текста. В этом случае явно видно, что она является не новой вложенной строкой кода, а продолжением предыдущей. Примеры:

```csharp
public VariablesValuesService(VariableService variableService
                            , FinGrbsDocumentsService documentService
                            , RpnManager rpnManager
                            , BudgetPlanningContext dbContext)
```
                            
```csharp
var dalObject = _dbContext.FinGrbsDocuments
    .Where(d => d.PeriodId == periodId && d.GrbsId == grbsId)
    .OrderByDescending(d => d.CreateDate)
    .ThenByDescending(d => d.Id)
    .FirstOrDefault();
```

```csharp
return variableIds != null
    && variableIds.Length > 0
    && varValues != null
    && varValues.Length == variableIds.Length;
```

Исключение составляют инициализаторы коллекций и объектов.

12. При разбиении длинных строк на части очень желательно, чтобы части строки, находящиеся на одном уровне синтаксического дерева, имели одинаковый отступ. Соответственно, чем ниже уровень элемента в синтаксическом дереве, тем больше отступ у него должен быть.

13. Заполнение всех свойств класса бизнес-сущности или DAL-сущности должно происходить в нестатическом методе SetProperties этого класса. При этом основной конструктор (в котором заполняются все свойства) должен делегировать обязанность по заполнению свойств этому методу. Пример:

```csharp
public class Person
{
    public int Id { get; set; }
    public string Name { get; set; }
    public DateTime BirthDay { get; set; }
     
    public Person(int id, string name, DateTime birthDay)
    {
        SetProperties(id, name, birthDay);
    }
     
    public void SetProperties(int id, string name, DateTime birthDay)
    {
        this.Id = id;
        this.Name = name;
        this.BirthDay = birthDay;
    }
}
```

Все другие конструкторы класса должны работать только через вызов основного конструктора.
Если в рамках решения какой-либо задачи требуется установить конкретные свойства сущности, то для этих целей необходимо создавать соответствующие методы в бизнес-сервисах: `SetComment(...)`, `SetEmailAndPhone(...)` и т.п.

14. Не допускается применять вложенный вызов методов. Т.е. вызов вида:

```csharp
var indicatorsForPage = GetIndicatorsForPage(GetIndicators(year, reportingStageId), page, sortType, sortDirection);
```

недопустим, необходимо вызвать методы по очереди:

```csharp
var indicators = GetIndicators(year, reportingStageId);
var indicatorsForPage = GetIndicatorsForPage(indicators, page, sortType, sortDirection);
```

15. Локальные функции должны располагаться в конце метода, после его основного кода.
